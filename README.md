# EPUB 3 to EPUB 2 批量转换脚本

这是一个用 Python 编写的轻量化转换工具，专门用于将 **EPUB 3** 标准的电子书批量降级为 **EPUB 2** 兼容格式。

### 为什么需要它？

市面上常用的工具（如 Calibre 或 Pandoc）在转换格式时，通常会重新解析并生成 HTML/CSS。这种“重写”过程往往会破坏复杂的原始排版，导致样式丢失。

**本脚本的思路是“最小化改动”：**
它不触动书籍的核心内容和样式表，仅针对元数据和导航结构进行重构，从而在保持原始排版的前提下，解决老旧设备（如旧款 Kindle、汉王等）不支持 EPUB 3 的问题。

---

## 核心功能

* **无损转换**：仅修改版本描述文件（OPF）和导航索引，**不修改** HTML 源代码和 CSS，确保排版原汁原味。
* **目录重构**：递归解析 EPUB 3 的 `nav` 节点，自动生成 EPUB 2 必需的 `toc.ncx` 目录文件。
* **兼容性修正**：自动清理 EPUB 3 特有的属性定义（如 `properties="nav"`），并将 `content.opf` 的版本标头降级为 2.0。
* **标准封装**：严格遵循 EPUB 打包规范，确保 `mimetype` 文件位于压缩包首位且不被压缩，可通过官方格式校验。

---

## 技术实现

1. **解析引擎**：基于 `lxml` 高效解析 XML 和 XHTML。
2. **深度遍历**：使用 DFS 算法遍历导航文档，确保多级嵌套目录在降级后依然完整。
3. **多线程处理**：GUI 界面与转换逻辑异步运行，批量处理大量书籍时界面不会卡死。

---

## 开始使用

### 环境要求

* **Python**: 3.8+
* **依赖库**:
```bash
pip install lxml

```



### 使用步骤

1. **选择路径**：在界面中指定 EPUB 3 文件所在的文件夹。
2. **导出设置**：设置转换后的保存位置。
3. **开始转换**：点击执行，脚本会自动完成版本降级与索引重构。

---

## 适用场景

* **旧设备用户**：让只支持 EPUB 2 的老阅读器正常显示新版书籍的目录。
* **排版强迫症**：不希望因格式转换导致 CSS 布局错乱。
* **批量整理**：需要快速处理大量数字藏书的兼容性问题。

---

**需要我帮你针对脚本的某个具体功能（比如 GUI 界面或者具体的转换逻辑）再细化一下描述吗？**
